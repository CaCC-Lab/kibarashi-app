/**
 * 改善されたプロンプトテンプレート
 * AさんBさんの豊富なバリエーションを参考に作成
 */

export const DETAILED_ACTIVITY_CATEGORIES = {
  // 認知的気晴らし（頭の中で行う）
  cognitive: {
    // 想像・妄想系
    imagination: [
      '理想の○○を想像する（旅行先、部屋、生活など）',
      '将来の成功した自分を詳細に思い描く',
      '行ってみたい場所への妄想旅行',
      '理想のペットとの生活を想像',
      '憧れの職業になりきって想像'
    ],
    // 自己対話・肯定系
    selfTalk: [
      '「大丈夫だよ」と優しく自分に語りかける',
      '今日頑張った自分を3つ褒める',
      '自分を労わる言葉を10個考える',
      '「ぜったいにうまくいく！」と声に出す',
      '過去の成功体験を思い出す'
    ],
    // 感覚集中系
    sensoryFocus: [
      '今聞こえる音を5つ数える',
      '見えるものの色を10個挙げる',
      '体の各部分の感覚に順番に意識を向ける',
      '呼吸の音とリズムに集中する',
      '心臓の鼓動を感じる'
    ],
    // 思考整理系
    thinking: [
      '今の悩みを3つの要素に分解してみる',
      '問題を他人事として客観視する',
      '感謝できることを10個数える',
      '今の状況の良い面を5つ見つける',
      '偉人ならどう考えるか想像する'
    ]
  },
  
  // 行動的気晴らし（体を動かす）
  behavioral: {
    // 飲食系（細分化の例）
    foodDrink: {
      coffee: [
        'コーヒー豆の香りを楽しむ',
        'お湯を注ぐ音に耳を傾ける',
        'コーヒーの色の変化を観察',
        'カップの温かさを手で感じる',
        '最初の一口をゆっくり味わう'
      ],
      tea: [
        '茶葉の香りを深く吸い込む',
        'お湯の温度を肌で感じる',
        '茶葉が開く様子を眺める',
        'カップを両手で包み込む',
        '一口ずつ違う味を探す'
      ],
      snack: [
        'チョコレートを舌でゆっくり溶かす',
        'クッキーの食感を楽しむ',
        'フルーツの香りを嗅ぐ',
        'ナッツを一粒ずつ味わう',
        '炭酸水の泡を感じる'
      ]
    },
    
    // 軽運動系
    exercise: {
      stretching: [
        '首をゆっくり左右に回す',
        '肩甲骨を大きく動かす',
        '手首・足首をくるくる回す',
        '背伸びを3回繰り返す',
        '椅子に座ったまま体をひねる'
      ],
      walking: [
        '建物の周りを一周する',
        '階段を使って別の階へ',
        'その場で足踏み50回',
        '廊下を端から端まで歩く',
        '窓際まで歩いて景色を見る'
      ],
      micro: [
        '手のひらをグーパー10回',
        'つま先立ちを20回',
        '肩を上げ下げ10回',
        '深呼吸しながら腕を大きく回す',
        'その場でジャンプ5回'
      ]
    },
    
    // 創作・作業系
    creative: {
      simple: [
        '紙に円を描き続ける',
        '文字を丁寧に書く練習',
        '簡単な折り紙を作る',
        'ペンで模様を描く',
        '付箋にイラストを描く'
      ],
      organizing: [
        'デスクの上を整理する',
        'ペン立てを整頓する',
        '引き出しの中を片付ける',
        '本を大きさ順に並べる',
        'カバンの中身を整理する'
      ]
    },
    
    // コミュニケーション系
    social: {
      digital: [
        '友人に「元気？」とLINE',
        '家族に近況報告メール',
        'SNSで好きな投稿にいいね',
        '感謝のメッセージを送る',
        '昔の写真を共有する'
      ],
      real: [
        '同僚に「お疲れ様」と声かけ',
        '近くの人に笑顔で会釈',
        '「ありがとう」を3回言う',
        '誰かを褒める',
        '挨拶を丁寧にする'
      ]
    },
    
    // 趣味・興味系
    hobby: {
      search: [
        '好きな動物の画像を3枚探す',
        '行きたい場所の写真を見る',
        '好きな音楽を1曲聴く',
        '面白い動画を1つ見る',
        '天気予報をチェックする'
      ],
      mini: [
        'スマホの壁紙を変える',
        'アプリを1つ整理する',
        'メモに今の気持ちを書く',
        'カレンダーに予定を追加',
        '時計を見て今の時間を意識する'
      ]
    }
  }
};

/**
 * 時間枠別の活動粒度ガイドライン
 */
export const TIME_BASED_GUIDELINES = {
  5: {
    description: '短時間でサッとできる即効性のある活動',
    characteristics: [
      '準備不要ですぐ始められる',
      '場所を選ばない',
      '集中力を必要としない',
      '中断しても問題ない',
      '道具不要または最小限'
    ],
    examples: [
      '深呼吸3セット',
      '目を閉じて30秒瞑想',
      '好きな写真を1枚見る',
      'ストレッチ2種類',
      '感謝することを3つ思い浮かべる'
    ]
  },
  15: {
    description: 'しっかりとリフレッシュできる中程度の活動',
    characteristics: [
      'ある程度の集中が可能',
      '複数ステップの活動OK',
      '軽い道具の使用可能',
      '環境を少し整える余裕あり',
      '効果を実感できる長さ'
    ],
    examples: [
      'コーヒーをゆっくり淹れて飲む',
      '短い散歩に出る',
      '日記を1ページ書く',
      '軽い筋トレセット',
      '好きな音楽を3曲聴く'
    ]
  },
  30: {
    description: 'じっくり取り組める本格的な気晴らし',
    characteristics: [
      '没頭できる活動',
      '複雑な手順もOK',
      '道具や準備が必要でも可',
      '達成感のある活動',
      '習慣化できる内容'
    ],
    examples: [
      '料理を1品作る',
      'ヨガの完全なセッション',
      '読書を1章分',
      'オンライン学習1レッスン',
      '部屋の模様替え'
    ]
  }
};

/**
 * 性別を超えたユニバーサルな提案のためのバランス配慮
 */
export const UNIVERSAL_BALANCE_GUIDELINES = {
  avoidStereotypes: [
    '「女性向け」「男性向け」という固定観念を避ける',
    'スイーツも筋トレも誰でも楽しめる活動として提案',
    '感情表現（泣く、叫ぶ）も性別問わず健康的な発散方法',
    '料理、掃除、運動、勉強すべて中性的に表現'
  ],
  
  inclusiveLanguage: [
    '「強い」「優しい」などの形容詞を性別と結びつけない',
    '家族との連絡も友人との交流も平等に扱う',
    '趣味の表現を多様化（ゲーム、読書、創作、運動など）',
    'セルフケアを「弱さ」ではなく「強さ」として表現'
  ],
  
  balancedOptions: {
    emotional: ['感情解放系', 'セルフケア系', '内省系'],
    physical: ['激しい運動', '優しいストレッチ', 'リズム運動'],
    creative: ['言語的創作', '視覚的創作', '音楽的表現'],
    social: ['デジタル交流', '対面交流', '一人の時間']
  }
};

/**
 * 改善されたプロンプト生成関数
 */
export function generateImprovedPrompt(
  situation: string,
  duration: number,
  ageGroup: string,
  previousSuggestions: string[] = []
): string {
  const timeGuideline = TIME_BASED_GUIDELINES[duration as 5 | 15 | 30];
  
  // 年齢層別のペルソナとターゲット設定
  const ageGroupSettings = getAgeGroupSettings(ageGroup);
  
  return `${ageGroupSettings.persona}

【条件】
- 場所: ${getSituationLabel(situation, ageGroup)}
- 時間: ${duration}分（${timeGuideline.description}）
- 対象: ${ageGroupSettings.target}

【重要な指針】
1. **具体性と細分化**
   - 抽象的な提案（例：「リラックスする」）は避ける
   - 具体的な動作や手順を含める（例：「右手で左肩を10秒押さえて離す」）
   - 一つの活動を複数の要素に分解して楽しむ方法を含める

2. **多様性の確保**
   - 五感（視覚、聴覚、触覚、嗅覚、味覚）を活用
   - 認知的/行動的のバランスを取る
   - 性別のステレオタイプを避け、誰でも楽しめる内容に

3. **創造的なアプローチ**
   - 「コーヒーを飲む」→「コーヒー豆の香りを楽しむ」「カップの温かさを感じる」など細分化
   - 日常的な行動に新しい視点を加える
   - 想像力を使った独創的な提案も含める

4. **${duration}分の時間枠に最適化**
   ${timeGuideline.characteristics.map(c => `- ${c}`).join('\n   ')}

【避けるべき重複提案】
${previousSuggestions.length > 0 ? previousSuggestions.join(', ') : 'なし'}

【カテゴリ例からインスピレーション】
- 想像・妄想: 理想の○○を詳細に想像、なりきり遊び
- 感覚集中: 音を数える、色を探す、触感を楽しむ
- 微細運動: 指の体操、目の運動、呼吸法
- プチ創作: 落書き、メモ書き、簡単な工作
- デジタル活用: 写真を見る、音楽を聴く、メッセージを送る
- 食の楽しみ: 飲み物の香り、お菓子の食感、温度を感じる

各提案には必ず以下を含めてください：
- 魅力的で具体的なタイトル（15-20文字）
- 期待できる効果を含む説明（80-100文字）
- 3-5個の具体的なステップ
- 励ましの言葉を含むガイド文（150-200文字）

JSON形式で回答してください。`;
}

/**
 * 年齢層別の設定を取得
 */
function getAgeGroupSettings(ageGroup: string) {
  switch (ageGroup) {
    case 'student':
      return {
        persona: 'あなたは高校生・大学生（16-22歳）の気持ちに寄り添い、多様な気晴らし方法を提案する専門家です。\n勉強、友人関係、将来への不安など、学生特有のストレスを理解し、創造的で実践的なアドバイスを提供してください。',
        target: '16-22歳の高校生・大学生'
      };
    case 'middle_school':
      return {
        persona: 'あなたは中学生（13-15歳）に寄り添い、多様な気晴らし方法を提案する優しいカウンセラーです。\n思春期の複雑な心境を理解し、安全で創造的な活動を提案してください。',
        target: '13-15歳の中学生'
      };
    case 'job_seeker':
      return {
        persona: 'あなたは就職活動中の若者（20-24歳）に寄り添い、多様な気晴らし方法を提案するキャリアカウンセラーです。\n初めての就職活動の不安や緊張を理解し、創造的でリフレッシュできる活動を提案してください。',
        target: '20-24歳の就職活動中の方'
      };
    case 'career_changer':
      return {
        persona: 'あなたは転職活動中の方（25-49歳）の状況を深く理解し、多様な気晴らし方法を提案するキャリアアドバイザーです。\n現職との両立の大変さ、キャリアの悩みを理解し、創造的で実践的な活動を提案してください。',
        target: '25-49歳の転職活動中の方'
      };
    case 'housewife':
      return {
        persona: 'あなたは主婦・主夫の方の気持ちに共感し、多様な気晴らし方法を提案する実用的なアドバイザーです。\n家事や育児の負担を理解し、創造的で実践可能な活動を提案してください。',
        target: '25-45歳の主婦・主夫'
      };
    case 'elderly':
      return {
        persona: 'あなたは高齢者の方に寄り添い、多様な気晴らし方法を提案する丁寧なアドバイザーです。\n健康や生活の不安を理解し、無理のない創造的な活動を提案してください。',
        target: '65歳以上の高齢者'
      };
    default: // office_worker
      return {
        persona: 'あなたは職場でストレスを抱える人に多様な気晴らし方法を提案する専門家です。\n職場の人間関係やプレッシャーを理解し、創造的で実践的な活動を提案してください。',
        target: '20-40代の職場でストレスを抱える人'
      };
  }
}

/**
 * 状況ラベルを取得
 */
function getSituationLabel(situation: string, ageGroup: string): string {
  const situationMaps: Record<string, Record<string, string>> = {
    student: {
      workplace: '図書館・勉強場所',
      home: '自宅・自室',
      outside: '学校・外出先',
      studying: '勉強中・勉強の合間',
      school: '学校・大学で',
      commuting: '通学中（電車・バス）'
    },
    middle_school: {
      workplace: '図書館・勉強場所',
      home: '自宅・自室',
      outside: '学校・外出先',
      school: '学校で'
    },
    job_seeker: {
      workplace: '就活スペース・カフェ',
      home: '自宅',
      outside: '説明会場・面接会場付近',
      job_hunting: '就職活動中'
    },
    career_changer: {
      workplace: '職場',
      home: '自宅',
      outside: '外出先・移動中',
      job_hunting: '転職活動中'
    },
    default: {
      workplace: '職場',
      home: '家・自宅',
      outside: '外出先',
      job_hunting: '就職・転職活動中'
    }
  };

  const map = situationMaps[ageGroup] || situationMaps.default;
  return map[situation] || situation;
}